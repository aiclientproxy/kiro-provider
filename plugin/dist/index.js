var KiroProviderPlugin=function(Q,d,s){"use strict";var Z={exports:{}},W={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C=d,q=Symbol.for("react.element"),$=Symbol.for("react.fragment"),ee=Object.prototype.hasOwnProperty,se=C.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ae={key:!0,ref:!0,__self:!0,__source:!0};function H(a,l,t){var c,x={},m=null,g=null;t!==void 0&&(m=""+t),l.key!==void 0&&(m=""+l.key),l.ref!==void 0&&(g=l.ref);for(c in l)ee.call(l,c)&&!ae.hasOwnProperty(c)&&(x[c]=l[c]);if(a&&a.defaultProps)for(c in l=a.defaultProps,l)x[c]===void 0&&(x[c]=l[c]);return{$$typeof:q,type:a,key:m,ref:g,props:x,_owner:se.current}}W.Fragment=$,W.jsx=H,W.jsxs=H,Z.exports=W;var e=Z.exports;function te({credentialUuid:a,onRefreshToken:l,onSwitchToLocal:t}){const[c,x]=d.useState(null),[m,g]=d.useState(!1),[j,b]=d.useState(!1),[N,u]=d.useState(!1),[f,w]=d.useState(null),[A,_]=d.useState(!1),[y,k]=d.useState(!1),[L,p]=d.useState(null),[E,S]=d.useState(null),[I,v]=d.useState(!1),[o,P]=d.useState(!1),[O,R]=d.useState(!1),[M,K]=d.useState(!1),[B,T]=d.useState(null),U=d.useCallback(async()=>{if(j&&c){b(!1);return}b(!0),g(!0);try{const n=await s.getKiroCredentialFingerprint(a);x(n)}catch(n){console.error("获取指纹信息失败:",n)}finally{g(!1)}},[a,j,c]),F=d.useCallback(async()=>{if(c)try{await navigator.clipboard.writeText(c.machine_id),u(!0),setTimeout(()=>u(!1),2e3)}catch(n){console.error("复制失败:",n)}},[c]),D=d.useCallback(async()=>{if(y&&f){k(!1);return}k(!0),_(!0),p(null);try{const n=await s.usageApi.getKiroUsage(a);w(n)}catch(n){p(n instanceof Error?n.message:String(n))}finally{_(!1)}},[a,y,f]),z=d.useCallback(async()=>{if(o){P(!1);return}P(!0),v(!0);try{const n=await s.kiroCredentialApi.getCredentialStatus(a);S(n.health_score||0)}catch(n){console.error("获取 Kiro 状态失败:",n)}finally{v(!1)}},[a,o]),r=d.useCallback(async()=>{R(!0);try{const n=await s.kiroCredentialApi.refreshCredential(a);n.success?(console.log("Token 刷新成功:",n.message),l&&l()):console.error("Token 刷新失败:",n.error||n.message)}catch(n){console.error("Token 刷新异常:",n)}finally{R(!1)}},[a,l]),i=d.useCallback(async()=>{K(!0),T(null);try{const n=await s.switchKiroToLocal(a);T(n),n.success?(console.log("切换到本地成功:",n.message),t&&t()):console.error("切换到本地失败:",n.message),setTimeout(()=>{T(null)},5e3)}catch(n){console.error("切换到本地异常:",n),T({success:!1,message:n instanceof Error?n.message:String(n)})}finally{K(!1)}},[a,t]),h=d.useCallback(()=>{b(!1)},[]),X=d.useCallback(()=>{k(!1)},[]),ge=d.useCallback(()=>{P(!1)},[]);return{fingerprintInfo:c,fingerprintLoading:m,fingerprintExpanded:j,fingerprintCopied:N,usageInfo:f,usageLoading:A,usageExpanded:y,usageError:L,kiroHealthScore:E,kiroStatusLoading:I,kiroStatusExpanded:o,kiroRefreshing:O,switchingToLocal:M,switchResult:B,handleCheckFingerprint:U,handleCopyMachineId:F,handleCheckUsage:D,handleCheckKiroStatus:z,handleQuickRefresh:r,handleSwitchToLocal:i,closeFingerprintPanel:h,closeUsagePanel:X,closeStatusPanel:ge}}function re(a){return{kiro_oauth:"OAuth",gemini_oauth:"OAuth",qwen_oauth:"OAuth",antigravity_oauth:"OAuth",openai_key:"API Key",claude_key:"API Key",codex_oauth:"OAuth",claude_oauth:"OAuth",iflow_oauth:"OAuth",iflow_cookie:"Cookie"}[a]||a}function de(a){const l={manual:{text:"手动添加",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},imported:{text:"导入",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},private:{text:"私有",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},local:{text:"本地",color:"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400"},remote:{text:"远程",color:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-400"}},t={text:"手动添加",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"};return a&&l[a]||t}function le(a){const l={manual:s.User,imported:s.Upload,private:s.Lock,local:s.User,remote:s.Globe};return a&&l[a]||s.User}function ce({credential:a,isHealthy:l,isLocalActive:t}){const c=de(a.source),x=le(a.source);return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:s.cn("shrink-0 rounded-full p-3",a.is_disabled?"bg-gray-100 dark:bg-gray-800":l?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"),children:a.is_disabled?e.jsx(s.PowerOff,{className:"h-6 w-6 text-gray-400"}):l?e.jsx(s.Heart,{className:"h-6 w-6 text-green-600 dark:text-green-400"}):e.jsx(s.HeartOff,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-lg truncate",children:a.name||`凭证 #${a.uuid.slice(0,8)}`}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1.5",children:[e.jsx("span",{className:"rounded-full bg-muted px-2.5 py-1 text-xs font-medium",children:re(a.credential_type||"unknown")}),e.jsxs("span",{className:s.cn("rounded-full px-2.5 py-1 text-xs font-medium inline-flex items-center gap-1.5 whitespace-nowrap",c.color),children:[e.jsx(x,{className:"h-3 w-3 shrink-0"}),c.text]}),a.proxy_url&&e.jsxs("span",{className:"rounded-full px-2.5 py-1 text-xs font-medium inline-flex items-center gap-1.5 whitespace-nowrap bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400",title:`代理: ${a.proxy_url}`,children:[e.jsx(s.Globe,{className:"h-3 w-3 shrink-0"}),"代理"]}),t&&e.jsx("span",{className:"rounded-full px-2.5 py-1 text-xs font-medium inline-flex items-center gap-1.5 whitespace-nowrap bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400",children:"本地活跃"})]})]})]})}function ie({credential:a,isOAuth:l,checkingHealth:t,refreshingToken:c,fingerprintLoading:x,fingerprintExpanded:m,usageLoading:g,usageExpanded:j,kiroStatusLoading:b,kiroStatusExpanded:N,kiroRefreshing:u,switchingToLocal:f,deleting:w,onToggle:A,onEdit:_,onCheckHealth:y,onRefreshToken:k,onCheckFingerprint:L,onCheckUsage:p,onCheckKiroStatus:E,onQuickRefresh:S,onSwitchToLocal:I,onReset:v,onDelete:o}){return e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:A,className:s.cn("rounded-lg p-2.5 text-xs font-medium transition-colors",a.is_disabled?"bg-green-100 text-green-700 hover:bg-green-200 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300"),title:a.is_disabled?"启用":"禁用",children:a.is_disabled?e.jsx(s.Power,{className:"h-4 w-4"}):e.jsx(s.PowerOff,{className:"h-4 w-4"})}),e.jsx("button",{onClick:_,className:"rounded-lg bg-blue-100 p-2.5 text-blue-700 hover:bg-blue-200 dark:bg-blue-900/30 dark:text-blue-400 transition-colors",title:"编辑",children:e.jsx(s.Settings,{className:"h-4 w-4"})}),e.jsx("button",{onClick:y,disabled:t,className:"rounded-lg bg-emerald-100 p-2.5 text-emerald-700 hover:bg-emerald-200 disabled:opacity-50 dark:bg-emerald-900/30 dark:text-emerald-400 transition-colors",title:"检测",children:e.jsx(s.Activity,{className:s.cn("h-4 w-4",t&&"animate-pulse")})}),l&&e.jsx("button",{onClick:k,disabled:c,className:"rounded-lg bg-purple-100 p-2.5 text-purple-700 hover:bg-purple-200 disabled:opacity-50 dark:bg-purple-900/30 dark:text-purple-400 transition-colors",title:"刷新 Token",children:e.jsx(s.RefreshCw,{className:s.cn("h-4 w-4",c&&"animate-spin")})}),e.jsx("button",{onClick:L,disabled:x,className:s.cn("rounded-lg p-2.5 transition-colors disabled:opacity-50",m?"bg-indigo-200 text-indigo-800 dark:bg-indigo-800 dark:text-indigo-200":"bg-indigo-100 text-indigo-700 hover:bg-indigo-200 dark:bg-indigo-900/30 dark:text-indigo-400"),title:"查看设备指纹",children:e.jsx(s.Fingerprint,{className:s.cn("h-4 w-4",x&&"animate-pulse")})}),e.jsx("button",{onClick:p,disabled:g,className:s.cn("rounded-lg p-2.5 transition-colors disabled:opacity-50",j?"bg-cyan-200 text-cyan-800 dark:bg-cyan-800 dark:text-cyan-200":"bg-cyan-100 text-cyan-700 hover:bg-cyan-200 dark:bg-cyan-900/30 dark:text-cyan-400"),title:"查看用量",children:e.jsx(s.BarChart3,{className:s.cn("h-4 w-4",g&&"animate-pulse")})}),e.jsx("button",{onClick:E,disabled:b,className:s.cn("rounded-lg p-2.5 transition-colors disabled:opacity-50",N?"bg-emerald-200 text-emerald-800 dark:bg-emerald-800 dark:text-emerald-200":"bg-emerald-100 text-emerald-700 hover:bg-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-400"),title:"查看详细状态和健康分数",children:e.jsx(s.Activity,{className:s.cn("h-4 w-4",b&&"animate-pulse")})}),e.jsx("button",{onClick:S,disabled:u,className:s.cn("rounded-lg p-2.5 transition-colors disabled:opacity-50",u?"bg-blue-200 text-blue-800 dark:bg-blue-800 dark:text-blue-200":"bg-blue-100 text-blue-700 hover:bg-blue-200 dark:bg-blue-900/30 dark:text-blue-400"),title:"快速刷新 Token",children:e.jsx(s.RefreshCw,{className:s.cn("h-4 w-4",u&&"animate-spin")})}),e.jsx("button",{onClick:I,disabled:f,className:s.cn("rounded-lg p-2.5 transition-colors disabled:opacity-50",f?"bg-amber-200 text-amber-800 dark:bg-amber-800 dark:text-amber-200":"bg-amber-100 text-amber-700 hover:bg-amber-200 dark:bg-amber-900/30 dark:text-amber-400"),title:"切换到本地 Kiro IDE",children:e.jsx(s.MonitorDown,{className:s.cn("h-4 w-4",f&&"animate-pulse")})}),e.jsx("button",{onClick:v,className:"rounded-lg bg-orange-100 p-2.5 text-orange-700 hover:bg-orange-200 dark:bg-orange-900/30 dark:text-orange-400 transition-colors",title:"重置",children:e.jsx(s.RotateCcw,{className:"h-4 w-4"})}),e.jsx("button",{onClick:o,disabled:w,className:"rounded-lg bg-red-100 p-2.5 text-red-700 hover:bg-red-200 disabled:opacity-50 dark:bg-red-900/30 dark:text-red-400 transition-colors",title:"删除",children:e.jsx(s.Trash2,{className:"h-4 w-4"})})]})}function G(a){return a?new Date(a).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"从未"}function ne({credential:a,isOAuth:l,kiroHealthScore:t}){var x,m;const c=(a.error_count||0)>0;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden sm:block px-4 py-3 bg-muted/30 border-t border-border/30",children:e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.Activity,{className:"h-5 w-5 text-blue-500 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"使用次数"}),e.jsx("div",{className:"font-bold text-xl tabular-nums",children:a.usage_count})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.AlertTriangle,{className:s.cn("h-5 w-5 shrink-0",c?"text-yellow-500":"text-green-500")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"错误次数"}),e.jsx("div",{className:"font-bold text-xl tabular-nums",children:a.error_count})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.Clock,{className:"h-5 w-5 text-muted-foreground shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"最后使用"}),e.jsx("div",{className:"font-medium text-sm",children:G(a.last_used)})]})]}),l?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.Timer,{className:s.cn("h-5 w-5 shrink-0",(x=a.token_cache_status)!=null&&x.expiry_time?a.token_cache_status.is_expiring_soon?"text-yellow-500":a.token_cache_status.is_valid?"text-green-500":"text-red-500":"text-gray-400")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Token 有效期"}),(m=a.token_cache_status)!=null&&m.expiry_time?e.jsx("div",{className:s.cn("font-medium text-sm",a.token_cache_status.is_expiring_soon?"text-yellow-600 dark:text-yellow-400":a.token_cache_status.is_valid?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:G(a.token_cache_status.expiry_time)}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"--"})]})]}):e.jsx("div",{}),t!==null?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:s.cn("h-5 w-5 shrink-0 rounded-full flex items-center justify-center text-xs font-bold text-white",t>=80?"bg-green-500":t>=60?"bg-yellow-500":t>=40?"bg-orange-500":"bg-red-500"),children:"★"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"健康分数"}),e.jsx("div",{className:s.cn("font-bold text-xl tabular-nums",t>=80?"text-green-600 dark:text-green-400":t>=60?"text-yellow-600 dark:text-yellow-400":t>=40?"text-orange-600 dark:text-orange-400":"text-red-600 dark:text-red-400"),children:Math.round(t)})]})]}):a.last_health_check_time?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.Activity,{className:"h-5 w-5 text-emerald-500 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"健康检查"}),e.jsx("div",{className:"font-medium text-sm",children:G(a.last_health_check_time)})]})]}):e.jsx("div",{})]})}),e.jsx("div",{className:"sm:hidden px-4 py-3 bg-muted/30 border-t border-border/30",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.Activity,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"使用:"}),e.jsx("span",{className:"font-semibold",children:a.usage_count})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.AlertTriangle,{className:s.cn("h-4 w-4",c?"text-yellow-500":"text-green-500")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"错误:"}),e.jsx("span",{className:"font-semibold",children:a.error_count})]}),e.jsxs("div",{className:"flex items-center gap-2 col-span-2",children:[e.jsx(s.Clock,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"最后使用:"}),e.jsx("span",{className:"text-sm",children:G(a.last_used)})]})]})})]})}function oe({expanded:a,loading:l,info:t,onClose:c,onCopyMachineId:x,copied:m}){return a?e.jsxs("div",{className:"mx-4 mb-4 p-4 rounded-lg bg-indigo-50 dark:bg-indigo-950/30 border border-indigo-200 dark:border-indigo-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm font-medium text-indigo-700 dark:text-indigo-300 flex items-center gap-2",children:[e.jsx(s.Fingerprint,{className:"h-4 w-4"}),"设备指纹"]}),e.jsx("button",{onClick:c,className:"text-indigo-500 hover:text-indigo-700 dark:hover:text-indigo-300",children:e.jsx(s.ChevronUp,{className:"h-4 w-4"})})]}),l?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-600 dark:text-indigo-400",children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full"}),"加载中..."]}):t?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Machine ID:"}),e.jsxs("code",{className:"text-sm font-mono bg-white dark:bg-gray-800 px-2 py-1 rounded border",children:[t.machine_id_short,"..."]}),e.jsx("button",{onClick:x,className:"p-1.5 rounded hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition-colors",title:"复制完整 Machine ID",children:m?e.jsx(s.Check,{className:"h-4 w-4 text-green-500"}):e.jsx(s.Copy,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"来源:"}),e.jsx("span",{className:s.cn("px-2 py-0.5 rounded font-medium",t.source==="profileArn"?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400":t.source==="clientId"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:t.source})]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"认证:"}),e.jsx("span",{className:s.cn("px-2 py-0.5 rounded font-medium",t.auth_method.toLowerCase()==="idc"?"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400":"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400"),children:t.auth_method})]})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"无法获取指纹信息"})]}):null}function V(a){return a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(1)}K`:a.toFixed(1)}function J({usage:a,loading:l}){if(l)return e.jsxs("div",{className:"rounded-lg border p-4 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-1/3 mb-3"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"h-12 bg-muted rounded"}),e.jsx("div",{className:"h-12 bg-muted rounded"}),e.jsx("div",{className:"h-12 bg-muted rounded"})]})]});const t=a.usageLimit>0?Math.round(a.currentUsage/a.usageLimit*100):0;return e.jsxs("div",{className:s.cn("rounded-lg border p-4",a.isLowBalance?"border-amber-300 bg-amber-50/50 dark:border-amber-700 dark:bg-amber-950/30":"border-border bg-card"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.Zap,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-medium text-sm",children:a.subscriptionTitle||"用量信息"})]}),a.isLowBalance&&e.jsxs("div",{className:"flex items-center gap-1 text-amber-600 dark:text-amber-400",children:[e.jsx(s.AlertTriangle,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs font-medium",children:"余额不足"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:s.cn("h-full transition-all",a.isLowBalance?"bg-amber-500":t>50?"bg-blue-500":"bg-green-500"),style:{width:`${Math.min(t,100)}%`}})}),e.jsxs("div",{className:"flex justify-between mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["已使用 ",t,"%"]}),e.jsxs("span",{children:["剩余 ",100-t,"%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center p-2 rounded-lg bg-muted/50",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"总额度"}),e.jsx("div",{className:"font-semibold text-sm",children:V(a.usageLimit)})]}),e.jsxs("div",{className:"text-center p-2 rounded-lg bg-muted/50",children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"已使用"}),e.jsx("div",{className:"font-semibold text-sm",children:V(a.currentUsage)})]}),e.jsxs("div",{className:s.cn("text-center p-2 rounded-lg",a.isLowBalance?"bg-amber-100 dark:bg-amber-900/30":"bg-muted/50"),children:[e.jsx("div",{className:s.cn("text-xs mb-1",a.isLowBalance?"text-amber-600 dark:text-amber-400":"text-muted-foreground"),children:"余额"}),e.jsx("div",{className:s.cn("font-semibold text-sm",a.isLowBalance&&"text-amber-600 dark:text-amber-400"),children:V(a.balance)})]})]})]})}function xe({expanded:a,loading:l,info:t,error:c,onClose:x}){return a?e.jsxs("div",{className:"mx-4 mb-4 p-4 rounded-lg bg-cyan-50 dark:bg-cyan-950/30 border border-cyan-200 dark:border-cyan-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm font-medium text-cyan-700 dark:text-cyan-300 flex items-center gap-2",children:[e.jsx(s.BarChart3,{className:"h-4 w-4"}),"Kiro 用量"]}),e.jsx("button",{onClick:x,className:"text-cyan-500 hover:text-cyan-700 dark:hover:text-cyan-300",children:e.jsx(s.ChevronUp,{className:"h-4 w-4"})})]}),c?e.jsx("div",{className:"rounded-lg bg-red-100 p-3 text-sm text-red-700 dark:bg-red-900/30 dark:text-red-300",children:c}):t?e.jsx(J,{usage:t,loading:l}):e.jsx(J,{usage:{subscriptionTitle:"",usageLimit:0,currentUsage:0,balance:0,isLowBalance:!1},loading:!0})]}):null}function me({expanded:a,loading:l,healthScore:t,credential:c,kiroRefreshing:x,checkingHealth:m,onClose:g,onToggle:j,onQuickRefresh:b,onCheckHealth:N}){return a?e.jsxs("div",{className:"mx-4 mb-4 p-4 rounded-lg bg-emerald-50 dark:bg-emerald-950/30 border border-emerald-200 dark:border-emerald-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-sm font-medium text-emerald-700 dark:text-emerald-300 flex items-center gap-2",children:[e.jsx(s.Activity,{className:"h-4 w-4"}),"Kiro 详细状态"]}),e.jsx("button",{onClick:g,className:"text-emerald-500 hover:text-emerald-700 dark:hover:text-emerald-300",children:e.jsx(s.ChevronUp,{className:"h-4 w-4"})})]}),l?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-emerald-600 dark:text-emerald-400",children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-current border-t-transparent rounded-full"}),"加载中..."]}):t!==null?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-emerald-950/50 rounded-lg p-3 border border-emerald-200 dark:border-emerald-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-emerald-700 dark:text-emerald-300",children:"健康分数"}),e.jsxs("div",{className:s.cn("px-3 py-1 rounded-full text-sm font-bold",t>=80?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":t>=60?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":t>=40?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"),children:[Math.round(t)," / 100"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:s.cn("h-2 rounded-full transition-all duration-300",t>=80?"bg-green-500":t>=60?"bg-yellow-500":t>=40?"bg-orange-500":"bg-red-500"),style:{width:`${Math.max(0,Math.min(100,t))}%`}})}),e.jsx("div",{className:"mt-2 text-xs text-muted-foreground",children:c.is_disabled?"凭证已被自动禁用，需手动重新启用":t>=80?"凭证状态良好，可正常使用":t>=60?"凭证状态一般，建议注意监控":t>=40?"凭证状态较差，可能有风险":"凭证状态异常，需要立即处理"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-emerald-950/50 rounded-lg p-3 border border-emerald-200 dark:border-emerald-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(s.Timer,{className:"h-4 w-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-emerald-700 dark:text-emerald-300",children:"冷却时间"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"根据使用频率计算的建议等待时间"})]}),e.jsxs("div",{className:"bg-white dark:bg-emerald-950/50 rounded-lg p-3 border border-emerald-200 dark:border-emerald-800",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(s.BarChart3,{className:"h-4 w-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-emerald-700 dark:text-emerald-300",children:"使用权重"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"在轮询池中的权重分配"})]})]}),e.jsx("div",{className:"flex gap-2 pt-2 border-t border-emerald-200 dark:border-emerald-800",children:c.is_disabled?e.jsxs("button",{onClick:j,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 transition-colors text-sm",children:[e.jsx(s.Power,{className:"h-4 w-4"}),"重新启用"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:b,disabled:x,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm",children:[e.jsx(s.RefreshCw,{className:s.cn("h-4 w-4",x&&"animate-spin")}),x?"刷新中...":"立即刷新"]}),e.jsxs("button",{onClick:N,disabled:m,className:"flex-1 flex items-center justify-center gap-2 px-3 py-2 bg-white dark:bg-emerald-950/50 border border-emerald-300 dark:border-emerald-700 text-emerald-700 dark:text-emerald-300 rounded-md hover:bg-emerald-50 dark:hover:bg-emerald-900/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm",children:[e.jsx(s.Activity,{className:s.cn("h-4 w-4",m&&"animate-pulse")}),m?"检查中...":"重新检查"]})]})})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"无法获取状态信息，请重试"})]}):null}function he({result:a}){return a?e.jsxs("div",{className:`mx-4 mb-3 rounded-lg p-3 text-sm ${a.success?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.success?e.jsx(s.Check,{className:"h-4 w-4 shrink-0"}):e.jsx(s.AlertTriangle,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{children:a.message})]}),a.success&&a.requires_kiro_restart&&e.jsx("div",{className:"mt-2 text-xs opacity-80",children:"请重启 Kiro IDE 使配置生效"})]}):null}function be({credential:a,onToggle:l,onDelete:t,onReset:c,onCheckHealth:x,onRefreshToken:m,onEdit:g,deleting:j,checkingHealth:b,refreshingToken:N,isLocalActive:u,onSwitchToLocal:f}){const w=(a.is_healthy??!1)&&!a.is_disabled,A=(a.credential_type||"").includes("oauth"),{fingerprintInfo:_,fingerprintLoading:y,fingerprintExpanded:k,fingerprintCopied:L,usageInfo:p,usageLoading:E,usageExpanded:S,usageError:I,kiroHealthScore:v,kiroStatusLoading:o,kiroStatusExpanded:P,kiroRefreshing:O,switchingToLocal:R,switchResult:M,handleCheckFingerprint:K,handleCopyMachineId:B,handleCheckUsage:T,handleCheckKiroStatus:U,handleQuickRefresh:F,handleSwitchToLocal:D,closeFingerprintPanel:z,closeUsagePanel:r,closeStatusPanel:i}=te({credentialUuid:a.uuid,onRefreshToken:m,onSwitchToLocal:f});return e.jsxs("div",{className:s.cn("rounded-xl border-2 transition-all hover:shadow-md",a.is_disabled?"border-gray-200 bg-gray-50/80 opacity-70 dark:border-gray-700 dark:bg-gray-900/60":u?"border-amber-400 bg-gradient-to-r from-amber-50/80 to-white dark:border-amber-500 dark:bg-gradient-to-r dark:from-amber-950/40 dark:to-transparent":w?"border-green-200 bg-gradient-to-r from-green-50/80 to-white dark:border-green-800 dark:bg-gradient-to-r dark:from-green-950/40 dark:to-transparent":"border-red-200 bg-gradient-to-r from-red-50/80 to-white dark:border-red-800 dark:bg-gradient-to-r dark:from-red-950/40 dark:to-transparent"),children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 pb-3",children:[e.jsx(ce,{credential:a,isHealthy:w,isLocalActive:u}),e.jsx(ie,{credential:a,isOAuth:A,checkingHealth:b,refreshingToken:N||!1,fingerprintLoading:y,fingerprintExpanded:k,usageLoading:E,usageExpanded:S,kiroStatusLoading:o,kiroStatusExpanded:P,kiroRefreshing:O,switchingToLocal:R,deleting:j,onToggle:l,onEdit:g,onCheckHealth:x,onRefreshToken:m,onCheckFingerprint:K,onCheckUsage:T,onCheckKiroStatus:U,onQuickRefresh:F,onSwitchToLocal:D,onReset:c,onDelete:t})]}),e.jsx(ne,{credential:a,isOAuth:A,kiroHealthScore:v}),e.jsx("div",{className:"px-4 py-2 border-t border-border/30",children:e.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:a.uuid})}),a.last_error_message&&e.jsxs("div",{className:"mx-4 mb-3 rounded-lg bg-red-100 p-3 text-xs text-red-700 dark:bg-red-900/30 dark:text-red-300",children:[a.last_error_message.slice(0,150),a.last_error_message.length>150&&"..."]}),e.jsx(he,{result:M}),e.jsx(oe,{expanded:k,loading:y,info:_,onClose:z,onCopyMachineId:B,copied:L}),e.jsx(me,{expanded:P,loading:o,healthScore:v,credential:a,kiroRefreshing:O,checkingHealth:b,onClose:i,onToggle:l,onQuickRefresh:F,onCheckHealth:x}),e.jsx(xe,{expanded:S,loading:E,info:p,error:I,onClose:r})]})}function Y(a){const[l,t]=d.useState([]),[c,x]=d.useState(!0),[m,g]=d.useState(null),[j,b]=d.useState(!1),[N,u]=d.useState(!1),[f,w]=d.useState(!1),[A,_]=d.useState(null),[y,k]=d.useState(!1),[L,p]=d.useState(new Set),[E,S]=d.useState(new Set),[I,v]=d.useState(new Set),o=d.useCallback(async()=>{try{x(!0),g(null);const r=await s.providerPoolApi.getCredentials("kiro");t(r)}catch(r){g(r instanceof Error?r.message:"加载凭证失败")}finally{x(!1)}},[]);d.useEffect(()=>{o()},[o]);const P=d.useCallback(()=>{b(!1),o(),s.toast.success("凭证添加成功")},[o]),O=d.useCallback(async r=>{if(confirm("确定要删除这个凭证吗？"))try{p(i=>new Set(i).add(r)),await s.providerPoolApi.deleteCredential(r,"kiro"),s.toast.success("凭证已删除"),o()}catch(i){s.toast.error(i instanceof Error?i.message:"删除失败")}finally{p(i=>{const h=new Set(i);return h.delete(r),h})}},[o]),R=d.useCallback(async(r,i)=>{try{await s.providerPoolApi.toggleCredential(r,!i),s.toast.success(i?"凭证已启用":"凭证已禁用"),o()}catch(h){s.toast.error(h instanceof Error?h.message:"操作失败")}},[o]),M=d.useCallback(async r=>{try{await s.providerPoolApi.resetCredential(r),s.toast.success("凭证已重置"),o()}catch(i){s.toast.error(i instanceof Error?i.message:"重置失败")}},[o]),K=d.useCallback(async r=>{try{S(h=>new Set(h).add(r));const i=await s.providerPoolApi.checkCredentialHealth(r);i.success?s.toast.success("凭证验证通过"):s.toast.error(i.message||"凭证验证失败"),o()}catch(i){s.toast.error(i instanceof Error?i.message:"验证失败")}finally{S(i=>{const h=new Set(i);return h.delete(r),h})}},[o]),B=d.useCallback(async r=>{try{v(i=>new Set(i).add(r)),await s.providerPoolApi.refreshCredentialToken(r),s.toast.success("Token 刷新成功"),o()}catch(i){s.toast.error(i instanceof Error?i.message:"刷新失败")}finally{v(i=>{const h=new Set(i);return h.delete(r),h})}},[o]),T=d.useCallback(r=>{_(r),k(!0)},[]),U=d.useCallback(async(r,i)=>{try{await s.providerPoolApi.updateCredential(r,i),s.toast.success("凭证已更新"),o()}catch(h){throw new Error(`编辑失败: ${h instanceof Error?h.message:String(h)}`)}},[o]),F=d.useCallback(()=>{k(!1),_(null)},[]),D=d.useCallback(async()=>{u(!0);try{for(const r of l)await s.providerPoolApi.refreshCredentialToken(r.uuid);s.toast.success("所有凭证已刷新"),o()}catch(r){s.toast.error(r instanceof Error?r.message:"刷新失败")}finally{u(!1)}},[l,o]),z=d.useCallback(async()=>{w(!0);try{let r=0,i=0;for(const h of l)(await s.providerPoolApi.checkCredentialHealth(h.uuid)).success?r++:i++;s.toast.info(`验证完成: ${r} 个有效, ${i} 个无效`),o()}catch(r){s.toast.error(r instanceof Error?r.message:"验证失败")}finally{w(!1)}},[l,o]);return c?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(s.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"加载凭证..."})]}):m?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx(s.AlertCircle,{className:"h-8 w-8 text-red-500 mb-2"}),e.jsx("p",{className:"text-red-600 mb-4",children:m}),e.jsxs(s.Button,{variant:"outline",onClick:o,children:[e.jsx(s.RefreshCw,{className:"h-4 w-4 mr-2"}),"重试"]})]}):e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Kiro 凭证管理"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(s.Button,{variant:"outline",size:"sm",onClick:z,disabled:f||l.length===0,children:[f?e.jsx(s.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):e.jsx(s.Zap,{className:"h-4 w-4 mr-1"}),"检测全部"]}),e.jsxs(s.Button,{variant:"outline",size:"sm",onClick:D,disabled:N||l.length===0,children:[N?e.jsx(s.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):e.jsx(s.RefreshCw,{className:"h-4 w-4 mr-1"}),"刷新全部"]}),e.jsxs(s.Button,{size:"sm",onClick:()=>b(!0),children:[e.jsx(s.Plus,{className:"h-4 w-4 mr-1"}),"添加凭证"]})]})]}),l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 border-2 border-dashed rounded-xl text-muted-foreground",children:[e.jsx(s.Key,{className:"h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"暂无凭证"}),e.jsx("p",{className:"text-sm mb-4",children:'点击"添加凭证"开始配置'}),e.jsxs(s.Button,{onClick:()=>b(!0),children:[e.jsx(s.Plus,{className:"h-4 w-4 mr-1"}),"添加第一个凭证"]})]}):e.jsx("div",{className:"space-y-4",children:l.map(r=>e.jsx(be,{credential:r,onToggle:()=>R(r.uuid,r.is_disabled),onDelete:()=>O(r.uuid),onReset:()=>M(r.uuid),onCheckHealth:()=>K(r.uuid),onRefreshToken:()=>B(r.uuid),onEdit:()=>T(r),deleting:L.has(r.uuid),checkingHealth:E.has(r.uuid),refreshingToken:I.has(r.uuid),onSwitchToLocal:o},r.uuid))}),e.jsx(s.Modal,{isOpen:j,onClose:()=>b(!1),maxWidth:"max-w-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"添加 Kiro (AWS) 凭证"}),e.jsx(s.KiroFormStandalone,{onSuccess:P,onCancel:()=>b(!1)})]})}),e.jsx(s.EditCredentialModal,{credential:A,isOpen:y,onClose:F,onEdit:U})]})}return Q.KiroProviderApp=Y,Q.default=Y,Object.defineProperties(Q,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),Q}({},React,ProxyCastPluginComponents);
